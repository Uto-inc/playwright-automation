# MEMORY.md - 長期記憶

## 2026-02-19: Notion統合ワークフロー改善 - 1依頼1ページルール確立

### 🚨 重要な学習：中間成果物を作らない
**問題**: Lead Management分析で1つの依頼に対して3つのNotionページを作成してしまい、親階層が散らかった
**解決**: 
- ✅ 中間ページ2つを削除（archived状態）
- ✅ 最終統合版のみ残す: https://www.notion.so/Lead-Management-2026-2-19-2026-2-19-30c4351de946812aae3ee2fe5555dd79
- ✅ TOOLS.mdに「1依頼1ページルール」を明記

### 💡 新ルール：1依頼1ページの鉄則
- **絶対守る**: 1つの依頼 = 1つの最終成果物ページのみ
- **禁止**: 試行錯誤の過程で複数ページ作成
- **方針**: 同一ページ更新 or 最初から完成版作成
- **整理**: 完了後は不要な中間ページを必ず削除

## 2026-02-19: Notion統合ワークフロー完成！Slack→AI分析→Notion出力

### 🚀 **完璧なワークフロー構築達成！**

**統合システム**: Slack入力 → AI分析 → Notion出力 → URL返信の完全自動化

**技術成果:**
- ✅ **2段階APIキー設計**: 読み取り用（HQ全体）+ 書き込み用（制限エリア）の完璧なセキュリティ
- ✅ **統合ワークフロースクリプト**: `notion-integrated-workflow.ts` 完成
- ✅ **多様な入力対応**: URL/自然言語/検索クエリを自動判定・処理
- ✅ **OpenClaw統合**: 環境変数設定でSlack連携準備完了
- ✅ **実動作確認**: Lead Management → 3行サマリー → Notion保存 → URL生成

**実証されたワークフロー:**
1. Slack → 多様な入力（「Lead Managementを確認」「栗田工業の案件」「URL直接」）
2. 読み取りAPI → Uto inc HQ全体から情報収集（セキュリティ設計通り）
3. AI分析 → 3行サマリー + 詳細レポート自動生成  
4. 書き込みAPI → 小島あい作業Workspace限定保存（権限制御）
5. **Slack自動返信**: サマリー内容 + NotionページURL

**セキュリティ設計:**
- **読み取り**: `ntn_[REDACTED_READ_KEY]` (HQ全体)
- **書き込み**: `ntn_[REDACTED_WRITE_KEY]` (制限エリア)
- **ダブルスタンダード問題完全解決**: 統一システムで複雑性除去

### 💡 重要な学習
- **設計思想の重要性**: 「編集制限+読み取り広範囲」の2段階設計が最適解
- **統合アプローチ**: 複数ツール統一でユーザビリティ向上
- **実用性重視**: URL以外の自然言語入力対応で実際の業務に適用

## 2026-02-19: Notion完全連携復旧完了！読み書き両対応

### 🎉 **「愛ちゃんにNotionのあのページ見てって頼んだら見れる & 書き込める」→ 100%達成！**

**問題**: セキュリティクリーンアップでSlack連携が全滅
**解決**: 読み取り専用 + 書き込み専用の2つのAPIキー体制で完全復旧

**技術成果:**
- ✅ 読み取り専用APIキー: WebChat用 (.env)
- ✅ 書き込み専用APIキー: Slack用 (TOOLS.md)  
- ✅ 正しいWorkspace ID特定: `30a4351de9468003a586fecc31127c90`
- ✅ Lead Managementデータベース: 完全アクセス可能
- ✅ 小島あい作業Workspace: 読み書き両対応
- ✅ OpenClaw再起動で設定反映完了

**実証されたワークフロー:**
1. Slack → NotionデータベースURL送信
2. 愛ちゃん: APIで読み取り・解析実行  
3. 調査結果: 小島あい作業Workspaceに自動保存
4. URL返信: 作成したページリンクをSlackに送信
5. **双方向連携完全復活** 🏆

### 💡 重要な学習
- **2つのAPIキー体制**: 用途別分離でセキュリティ向上
- **正確なPage ID特定**: 検索APIで実際のIDを確認する重要性
- **Integration接続**: APIキー作成後の接続設定が必須

## 2026-02-19: Vercel + GCP最適化プラン完成！AWS比1/4〜1/8のコスト削減実現

### 🚀 **AI会議代理出席システム Vercel+GCPハイブリッド構成**
**完璧なプラン策定書**: https://www.notion.so/AI-Vercel-GCP-2026-2-19-30c4351de94681879e5bcd69abf4f211

**技術的突破:**
- ✅ **Vercel + GCP ハイブリッド**: フロントエンド（Vercel）+ AI処理（GCP）
- ✅ **激安コスト構成**: 月額3-10万円（AWS案の1/4〜1/8削減）
- ✅ **運用超シンプル**: git push自動デプロイ + サーバーレス
- ✅ **社長チーム慣れ親しんだ技術**: Next.js + TypeScript + Tailwind

**詳細プラン内容:**
1. 🏗️ **システム構成**: Next.js（Vercel）+ Cloud Run（GCP）+ Speech-to-Text + Vertex AI（Gemini）
2. 💰 **コスト分析**: Vercel月額0-2万円 + GCP月額3-8万円
3. 🗺️ **7ヶ月実装プラン**: Phase1 MVP（2ヶ月）→ Phase2 学習強化（3ヶ月）→ Phase3 本格運用（2ヶ月）
4. 🔧 **技術仕様**: FastAPI + Docker + BigQuery RAG + WebSocket
5. ⚠️ **リスク対策**: Vercel制限対応、予算アラート、API制限監視

### 💡 重要な学習
- **コスト最適化の威力**: AWS→GCP移行で75-88%コスト削減可能
- **ハイブリッド構成の優位性**: 各プラットフォームの得意分野を活用
- **技術選定の重要性**: チームの習熟度 > 最新技術
- **プラン策定の価値**: 詳細設計で実装段階のリスク大幅軽減

### 🎯 Next Actions確定
1. **技術検証**: GCP Speech-to-Text + Gemini PoC（1週間）
2. **フロントエンド雛形**: Vercel + Next.js基盤構築（3日）
3. **声クローニング**: ElevenLabs実験（1週間）
4. **MVP開発開始**: Phase1実装（2ヶ月）

## 2026-02-19: Notion Reader V2 実用化完了 & システム開発標準プロセス確立

### 🎉 Notion Reader V2 完全実用化達成
**「愛ちゃんにNotionのあのページ見てって頼んだら見れるようになった」→ 100%達成！**

**技術成果:**
- ✅ チームスペース全体アクセス権限設定完了
- ✅ セキュアなAPI Key管理（環境変数）
- ✅ ページネーション・リトライ機構実装
- ✅ Markdown変換機能
- ✅ Slack連携で実動作確認済み

**実証されたワークフロー:**
1. 社長「Slackで依頼してみた」→ NotionデータベースURL送信
2. 愛ちゃん: URLからID抽出 `1224351de94680aa8101da1d1728e30e`
3. Notion Reader V2: APIアクセス実行
4. 404エラー → 権限問題を正確に特定・解決策提示
5. **完璧な動作確認完了** 🏆

**発見したクライアント情報:**
- DX関連案件: 6件（不動産、阪和興業、栗田工業など）
- 戦略関連案件: 5件（三井住友銀行、TENTIAL、アスイロなど）
- 内部資料: 営業戦略会議議事録など

### 🎯 社長からの重要指示
**「システム作って系の依頼があった時は必ず要件ヒアリング→プラン→Claude Code→Codex→GitHub Pushの順番で進める」**

### 💡 学んだ教訓
- いきなり実装に飛び込まず、**必ず要件を明確化**してからスタート
- プラン策定で技術選定・設計・リスク分析を事前実施
- 5ステップの標準フローを絶対に守る

### 📝 TOOLS.md更新内容
**システム開発ワークフロー（🚨必須）**として標準5ステップを明記：
1. 📝 要件ヒアリング
2. 🗺️ プラン策定  
3. ⚙️ Claude Code実装
4. 📋 Codexクロスバリデーション
5. 🐙 GitHub配信

## 2026-02-18: Webアプリ開発ワークフロー確立

### 🎯 重要な学習
**Webアプリ開発は3ステップ必須:**
1. **技術実装** - Vite + React + Tailwind CSS
2. **📋 Codexクロスバリデーション** - 品質保証のため必須
3. **🐙 GitHub Organization配信** - `Uto-inc/REPO_NAME` 形式

### 💡 発見した重要事実
- **GitHub Organization権限**: `Uto-inc` organizationにリポジトリ作成可能
- **コマンド**: `gh repo create Uto-inc/REPO_NAME --public --source=. --remote=origin --push`
- **Codexクロスバリデーション**: セキュリティ・アクセシビリティ・パフォーマンス改善に絶大な効果

### 🚨 忘れがちなポイント
- PostCSS設定（`postcss.config.js`）がTailwind使用時に必須
- Codexレビューで大幅なアクセシビリティ改善（ARIA属性、キーボード操作）
- State管理の競合対策（関数型setState）

### 🛠️ 技術的詳細
**今回のCodex修正内容:**
- アクセシビリティ: キーボード操作、ARIA属性、label関連付け
- State管理: 関数型更新で競合回避
- エラーハンドリング: フォールバック処理追加
- パフォーマンス: 不要なuseEffect削除

### 📝 記録すべき成功パターン
**React開発ベストプラクティス:**
- 関数型setState: `setData(prev => ...)`
- アクセシビリティ: `htmlFor` + `id` + `aria-*`
- エラー処理: `config[key] ?? fallback`
- セマンティックHTML: `<article>`, `role="button"`

### 🎭 社長からの指摘
「次回からは1発でできるようにSkillsか何かを更新」
→ TOOLS.mdに標準ワークフローを記録済み
→ この教訓を忘れないよう長期記憶に保存